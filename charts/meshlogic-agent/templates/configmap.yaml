apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "meshlogic-agent.fullname" . }}-config
  labels:
    {{- include "meshlogic-agent.labels" . | nindent 4 }}
data:
  agent.toml: |
    [agent]
    customer_id = {{ .Values.agent.customerId | quote }}
    safety_tier = {{ .Values.agent.safetyTier }}

    [ebpf]
    enable_process = {{ .Values.ebpf.enableProcess }}
    enable_file = {{ .Values.ebpf.enableFile }}
    enable_network = {{ .Values.ebpf.enableNetwork }}
    ring_buffer_size = {{ .Values.ebpf.ringBufferSize }}
    mute_paths = {{ .Values.ebpf.mutePaths | toJson }}

    [privacy]
    epsilon = {{ .Values.privacy.epsilon }}
    enable_noise = {{ .Values.privacy.enableNoise }}

    [telemetry]
    region = {{ .Values.agent.region | quote }}
    batch_size = {{ .Values.telemetry.batchSize }}
    flush_interval_secs = {{ .Values.telemetry.flushIntervalSecs }}

    [logging]
    level = {{ .Values.logging.level | quote }}
    json_format = {{ .Values.logging.jsonFormat }}

    [metrics]
    enabled = {{ .Values.metrics.enabled }}
    port = {{ .Values.metrics.port }}

    [health]
    port = {{ .Values.health.port }}
